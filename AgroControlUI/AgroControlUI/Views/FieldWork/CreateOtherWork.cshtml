@model AgroControlUI.DTOs.FieldWorks.CreateOtherWorkDto

<link rel="stylesheet" href="~/css/add.css" />
<link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css" rel="stylesheet" />
<link rel="stylesheet" href="~/css/addWithSelects.css" />
<link rel="stylesheet" href="~/css/colors.css" />
<link rel="stylesheet" href="~/css/selectWithInput.css" />
<style>
    .adding-input {
        width: 18%;
        height: 46px;
    }

    .adding-select {
        width: 49%;
    }

    .adding-unit {
        width: 18%;
    }
</style>
<div class="form-container">
    <div class="green-form">
        <form asp-action="CreateOtherWork" method="post">
            <h1>Dodaj prace</h1>
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="group">
                <input asp-for="Name"/>
                <span class="bar"></span>
                <label asp-for="Name">Rodzaj pracy</label>
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="single-dropdown">
                <select asp-for="FieldId" asp-items="ViewBag.Fields" id="fieldSelect" required>
                    <option value="">Wybierz pole</option>
                </select>
                <span class="bar"></span>
                <label asp-for="FieldId">Pole</label>
                <span asp-validation-for="FieldId" class="text-danger"></span>
            </div>

            @if (!User.IsInRole("Pracownik"))
            {
                <div class="single-dropdown">
                    <select id="workerSelect" name="workerSelect">
                        <option value="">Wybierz pracownika</option>
                        <optgroup label="Pracownicy">
                            @foreach (var employee in ViewBag.Employees)
                            {
                                <option value="@employee.Value" data-type="employee">@employee.Text</option>
                            }
                        </optgroup>
                        <optgroup label="Użytkownicy systemowi">
                            @foreach (var user in ViewBag.Users)
                            {
                                <option value="@user.Value" data-type="user">@user.Text</option>
                            }
                        </optgroup>
                    </select>
                    <span class="bar"></span>
                    <label>Pracownik</label>
                    <span asp-validation-for="EmployeeId" class="text-danger"></span>
                </div>

            }
            <input type="hidden" id="EmployeeId" name="EmployeeId" />
            <input type="hidden" id="AgroControlUserId" name="AgroControlUserId" />

            <div class="multi-dropdown">
                <select asp-for="FieldWorkAgriculturalEquipmentIds" required asp-items="ViewBag.AgriculturalEquipment" id="agricultrualEquipmentSelect" multiple></select>
                <span class="bar"></span>
                <label asp-for="FieldWorkAgriculturalEquipmentIds">Użyte maszyny</label>
                <span asp-validation-for="FieldWorkAgriculturalEquipmentIds" class="text-danger"></span>
            </div>

            <div class="group">
                <input asp-for="StartTime" type="datetime-local" />
                <span class="bar"></span>
                <label asp-for="StartTime">Data rozpoczęcia</label>
                <span asp-validation-for="StartTime" class="text-danger"></span>
            </div>

            <div class="group">
                <input asp-for="EndTime" type="datetime-local" />
                <span class="bar"></span>
                <label asp-for="EndTime">Data zakończenia*</label>
                <span asp-validation-for="EndTime" class="text-danger"></span>
            </div>

            <div class="group">
                <textarea asp-for="Description" class="description-field"></textarea>
                <span class="bar"></span>
                <label asp-for="Description">Opis*</label>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div style="margin-bottom:20px;margin-top:-35px">
                <span>* - pole opcjonalne</span>
            </div>

            <div class="action-buttons">
                <a asp-action="Index" class="cancel-btn">Anuluj</a>
                <button type="submit" class="add-btn">Dodaj</button>
            </div>
        </form>
    </div>
</div>

<script src="~/js/inputLabel.js"></script>
<script src="~/js/listOperations.js"></script>
<script src="~/lib/jquery-validation/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        new TomSelect("#fieldSelect", { create: false, sortField: "text", placeholder: "Wyszukaj...", plugins: ['remove_button'] });
        if (document.getElementById("workerSelect")) {
        new TomSelect("#workerSelect", {
            create: false,
            sortField: "text",
            placeholder: "Wyszukaj...",
            plugins: ['remove_button']
        });}
        new TomSelect("#agricultrualEquipmentSelect", { create: false, sortField: "text", placeholder: "Wyszukaj...", plugins: ['remove_button'] });


    });
    document.getElementById('workerSelect').addEventListener('change', function() {
        var selectedOption = this.options[this.selectedIndex];
        var selectedValue = selectedOption.value;
        var selectedType = selectedOption.getAttribute('data-type');

        if (selectedValue) {
            if (selectedType === 'employee') {
                document.getElementById('EmployeeId').value = selectedValue; 
                document.getElementById('AgroControlUserId').value = ''; 
            } else if (selectedType === 'user') {
                document.getElementById('AgroControlUserId').value = selectedValue; 
                document.getElementById('EmployeeId').value = '';
            }
        } else {
            document.getElementById('EmployeeId').value = '';
            document.getElementById('AgroControlUserId').value = '';
        }
    });
</script>
